<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
    <AuthenticodeSignTarget>false</AuthenticodeSignTarget>
  </PropertyGroup>
  <ItemGroup Condition=" '$(IsSpOfficialBuild)' == 'true' ">
    <PackageReference Include="Microsoft.VisualStudioEng.MicroBuild.Core">
      <PrivateAssets>All</PrivateAssets>
    </PackageReference>
    <ProjectReference Include="..\ServiceProfiler.EventPipe.AspNetCore\ServiceProfiler.EventPipe.AspNetCore.csproj" />
    <ProjectReference Include="..\ServiceProfiler.EventPipe.Client\ServiceProfiler.EventPipe.Client.csproj" />
  </ItemGroup>
  <Target Name="NuGetPackageSigning" BeforeTargets="SignFiles" Condition=" '$(IsSpOfficialBuild)' == 'true' ">
    <ItemGroup>
      <NugetPackages Include="..\ServiceProfiler.EventPipe.Client\bin\$(ConfigurationName)\*.nupkg" />
      <NuGetPackages Include="..\ServiceProfiler.EventPipe.AspNetCore\bin\$(ConfigurationName)\*.nupkg" />
    </ItemGroup>
    <!-- Signing happens within project output directory. -->
    <Move SourceFiles="@(NugetPackages)" DestinationFolder="$(OutDir)" />
    <ItemGroup>
      <FilesToSign Include="$(OutDir)\*.nupkg">
        <Authenticode>Nuget</Authenticode>
        <InProject>false</InProject>
      </FilesToSign>
    </ItemGroup>
  </Target>
  <!-- Artifacts are gathered from the bin folders, move signed NuGet packages. -->
  <Target Name="PostNuGetPackageSigning" AfterTargets="SignFiles" Condition=" '$(IsSpOfficialBuild)' == 'true' ">
    <ItemGroup>
      <SignedNugetPackages Include="$(OutDir)*.nupkg" />
    </ItemGroup>
    <Move SourceFiles="@(SignedNugetPackages)" DestinationFolder="$(OutDir)..\" />
  </Target>
</Project>
